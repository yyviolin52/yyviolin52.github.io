<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Digital Analytics, Web Analytics &amp; Data Science"><title>Important-SQL-Questions | Jacky Yuan Blog | Tech &amp; ML</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-170105937-1","auto"),ga("send","pageview")</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Important-SQL-Questions</h1><a id="logo" href="/.">Jacky Yuan Blog | Tech &amp; ML</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home">Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Important-SQL-Questions</h1><div class="post-meta">2020-06-20<span> | </span><span class="category"><a href="/categories/Database/">Database</a></span></div><a class="disqus-comment-count" data-disqus-identifier="2020/06/20/Important-SQL-Questions/" href="/2020/06/20/Important-SQL-Questions/#disqus_thread"></a><div class="post-content"><p><strong>这篇SQL习题是非死不可的力扣题，我自己作为学习记录笔记目的。请勿用于商业目的。</strong></p><a id="more"></a><p><strong>578. Get Highest Answer Rate Question</strong><br>Get the highest answer rate question from a table survey_log with these columns: uid, action, question_id, answer_id, q_num, timestamp.</p><p>uid means user id; action has these kind of values: “show”, “answer”, “skip”; answer_id is not null when action column is “answer”, while is null for “show” and “skip”; q_num is the numeral order of the question in current session.</p><p>Write a sql query to identify the question which has the highest answer rate.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">| uid  | action    | question_id  | answer_id  | q_num     | timestamp  |</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">| 5    | show      | 285          | null       | 1         | 123        |</span><br><span class="line">| 5    | answer    | 285          | 124124     | 1         | 124        |</span><br><span class="line">| 5    | show      | 369          | null       | 2         | 125        |</span><br><span class="line">| 5    | skip      | 369          | null       | 2         | 126        |</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">Output:</span><br><span class="line">+-------------+</span><br><span class="line">| survey_log  |</span><br><span class="line">+-------------+</span><br><span class="line">|    285      |</span><br><span class="line">+-------------+</span><br><span class="line">Explanation:</span><br><span class="line">question 285 has answer rate 1&#x2F;1, while question 369 has 0&#x2F;1 answer rate, so output 285.</span><br></pre></td></tr></table></figure><p>Note: The highest answer rate meaning is: answer number’s ratio in show number in the same question.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> question_id <span class="keyword">AS</span> survey_log</span><br><span class="line"><span class="keyword">FROM</span>(</span><br><span class="line"><span class="keyword">SELECT</span> question_id, <span class="keyword">SUM</span>(<span class="keyword">IF</span>(<span class="keyword">action</span>=<span class="string">'answer'</span>,<span class="number">1</span>,<span class="number">0</span>)) / <span class="keyword">SUM</span>(<span class="keyword">IF</span>(<span class="keyword">action</span>=<span class="string">'show'</span>,<span class="number">1</span>,<span class="number">0</span>)) <span class="keyword">as</span> ratio</span><br><span class="line"><span class="keyword">FROM</span> demo.survey_log</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> question_id</span><br><span class="line">) <span class="keyword">AS</span> sub</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> question_id</span><br><span class="line"><span class="keyword">Having</span> <span class="keyword">MAX</span>(ratio);</span><br></pre></td></tr></table></figure><p>这道题我自己拿进数据库跑了一下，是为了验证一下能不能写Having MAX（），注意前面要加GROUP BY因为是aggreated query。MySQL顺序执行：开始-&gt;FROM子句-&gt;WHERE子句-&gt;GROUP BY子句-&gt;HAVING子句-&gt;ORDER BY子句-&gt;SELECT子句-&gt;LIMIT子句-&gt;最终结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create table demo.survey_log (uid int,action varchar(25),question_id int,answer_id int,q_num int,timestamp int);</span><br><span class="line"></span><br><span class="line">insert into demo.survey_log values(5,&#39;show&#39;,285,null,1,123);</span><br><span class="line">insert into demo.survey_log values(5,&#39;answer&#39;,285,124124,1,124);</span><br><span class="line">insert into demo.survey_log values(5,&#39;show&#39;,369,null,2,125);</span><br><span class="line">insert into demo.survey_log values(5,&#39;skip&#39;,369,null,2,126);</span><br><span class="line">--随机加了两行试一下</span><br><span class="line">insert into demo.survey_log values(5,&#39;show&#39;,286,null,1,123);</span><br><span class="line">insert into demo.survey_log values(5,&#39;answer&#39;,286,124124,1,124);</span><br></pre></td></tr></table></figure><p>我觉得网上的答案有个问题就是，如果只取一个LIMIT 1，会造成相同的回答率的结果只有一个。</p><p>我个人不推荐，见网友Query：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT question_id AS &#39;survey_log&#39;</span><br><span class="line">FROM (</span><br><span class="line">    SELECT question_id,</span><br><span class="line">           SUM(CASE WHEN action&#x3D;&#39;answer&#39; THEN 1 ELSE 0 END) AS num_answer,</span><br><span class="line">           SUM(CASE WHEN action&#x3D;&#39;show&#39; THEN 1 ELSE 0 END) AS num_show</span><br><span class="line">    FROM survey_log</span><br><span class="line">    GROUP BY question_id</span><br><span class="line">    ) AS t</span><br><span class="line">ORDER BY (num_answer &#x2F; num_show) DESC</span><br><span class="line">LIMIT 0,1</span><br></pre></td></tr></table></figure><p>还有一种写法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT question_id AS survey_log</span><br><span class="line">FROM survey_log</span><br><span class="line">GROUP BY question_id</span><br><span class="line">ORDER BY SUM(IF(action&#x3D;&#39;answer&#39;, 1, 0)) &#x2F; SUM(IF(action&#x3D;&#39;show&#39;, 1, 0)) DESC</span><br><span class="line">LIMIT 0,1;</span><br></pre></td></tr></table></figure><ol start="597"><li>Friend Requests I: Overall Acceptance Rate<br>In social network like Facebook or Twitter, people send friend requests and accept others’ requests as well. Now given two tables as below:</li></ol><p>Table: friend_request<br>| sender_id | send_to_id |request_date|<br>|———–|————|————|<br>| 1 | 2 | 2016_06-01 |<br>| 1 | 3 | 2016_06-01 |<br>| 1 | 4 | 2016_06-01 |<br>| 2 | 3 | 2016_06-02 |<br>| 3 | 4 | 2016-06-09 |</p><p>Table: request_accepted<br>| requester_id | accepter_id |accept_date |<br>|————–|————-|————|<br>| 1 | 2 | 2016_06-03 |<br>| 1 | 3 | 2016-06-08 |<br>| 2 | 3 | 2016-06-08 |<br>| 3 | 4 | 2016-06-09 |<br>| 3 | 4 | 2016-06-10 |</p><p>Write a query to find the overall acceptance rate of requests rounded to 2 decimals, which is the number of acceptance divide the number of requests.</p><p>For the sample data above, your query should return the following result.</p><table><thead><tr><th>accept_rate</th></tr></thead><tbody><tr><td>0.80</td></tr></tbody></table><p>Note:<br>The accepted requests are not necessarily from the table friend_request. In this case, you just need to simply count the total accepted requests (no matter whether they are in the original requests), and divide it by the number of requests to get the acceptance rate.<br>It is possible that a sender sends multiple requests to the same receiver, and a request could be accepted more than once. In this case, the ‘duplicated’ requests or acceptances are only counted once.<br>If there is no requests at all, you should return 0.00 as the accept_rate.</p><p>Explanation: There are 4 unique accepted requests, and there are 5 requests in total. So the rate is 0.80.</p><p>Follow-up:<br>Can you write a query to return the accept rate but for every month?<br>How about the cumulative accept rate for every day?</p><p>SELECT<br>ROUND(<br>IFNULL(<br>(SELECT count(<em>) FROM (SELECT DISTINCT requester_id, accepter_id FROM request_accepted) AS A)<br>/<br>(SELECT count(</em>) FROM (SELECT DISTINCT sender_id, send_to_id FROM friend_request) AS B)<br>,0)<br>,2) AS accept_rate</p><p>selectcount( distinct col1 , col2 , col3 , …….) from table</p><p>但是，这样是不允许的，因为count是不能统计多个字段的，虽然distinct是可行的。</p><p>有种比较直接的方法就是把消除重复后在统计查询:</p><p>select count(*) from (select distinct col1 ,col2 , col3 from table)A</p></div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css"><p><span>Title: </span>Important-SQL-Questions</p><p><span>Author: </span>Jacky Yuan</p><p><span>Date: </span>2020-06-20</p><p><span>Last Update: </span>2020-06-20</p><p><span>Blog Link: </span><a href="/2020/06/20/Important-SQL-Questions/">http://yoursite.com/2020/06/20/Important-SQL-Questions/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="http://yoursite.com/2020/06/20/Important-SQL-Questions/"></i></span></p><p><span>Copyright Declaration: </span>The author owns the copyright. Please indicate the source reproduced!</p></div><br><div class="tags"><a href="/tags/SQL/"><i class="fa fa-tag"></i>SQL</a><a href="/tags/Leetcode/"><i class="fa fa-tag"></i>Leetcode</a><a href="/tags/Facebook/"><i class="fa fa-tag"></i>Facebook</a></div><div class="post-nav"><a class="next" href="/2020/06/17/SQL-exercises-in-LeetCode-easy-part/">SQL-exercises-in-LeetCode-easy-part</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config=function(){this.page.url="http://yoursite.com/2020/06/20/Important-SQL-Questions/",this.page.identifier="2020/06/20/Important-SQL-Questions/",this.page.title="Important-SQL-Questions"}</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({url:"https://disqus.com/next/config.json",timeout:2500,type:"GET",success:function(){var s=document,e=s.createElement("script");e.src="//disqus_TN33Be6Ke8.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(s.head||s.body).appendChild(e),$(".disqus_click_btn").css("display","none")},error:function(){$(".disqus_click_btn").css("display","block")}})</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//disqus_TN33Be6Ke8.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function(){var e=new XMLHttpRequest;e.open("GET","//disqus.com/next/config.json",!0),e.timeout=2500,e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){$(".post-meta .post-comments-count").show();var t=document.createElement("script");t.id="dsq-count-scr",t.src="https://disqus_TN33Be6Ke8.disqus.com/count.js",t.async=!0,(document.head||document.body).appendChild(t)}},e.ontimeout=function(){e.abort()},e.send(null)})</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o">Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o">Tags</i></div><div class="tagcloud"><a href="/tags/SQL/" style="font-size:15px">SQL</a> <a href="/tags/Leetcode/" style="font-size:15px">Leetcode</a> <a href="/tags/Facebook/" style="font-size:15px">Facebook</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o">Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/06/20/Important-SQL-Questions/">Important-SQL-Questions</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/17/SQL-exercises-in-LeetCode-easy-part/">SQL-exercises-in-LeetCode-easy-part</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o">Recent Comments</i></div><script type="text/javascript" src="//disqus_TN33Be6Ke8.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link">Links</i></div><ul></ul><a href="https://www.linkedin.com/in/jacky-yuan/" title="LinkedIn" target="_blank">LinkedIn</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Jacky Yuan Blog | Tech &amp; ML.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/love.js"></script><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>