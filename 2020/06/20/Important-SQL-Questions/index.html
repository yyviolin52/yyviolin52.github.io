<!DOCTYPE html><html lang="en"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="Digital Analytics, Web Analytics &amp; Data Science"><title>Important-SQL-Questions | Jacky Yuan Blog | Tech &amp; ML</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/normalize.css/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/pure-min.min.css"><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/npm/purecss/build/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.jsdelivr.net/npm/jquery/dist/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"><script>!function(e,a,t,n,g,c,o){e.GoogleAnalyticsObject=g,e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,c=a.createElement(t),o=a.getElementsByTagName(t)[0],c.async=1,c.src="https://www.google-analytics.com/analytics.js",o.parentNode.insertBefore(c,o)}(window,document,"script",0,"ga"),ga("create","UA-170105937-1","auto"),ga("send","pageview")</script><script type="text/javascript" src="//cdn.jsdelivr.net/npm/clipboard/dist/clipboard.min.js"></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.js"></script><link rel="stylesheet" href="//cdn.jsdelivr.net/gh/codeseven/toastr/build/toastr.min.css"><meta name="generator" content="Hexo 4.2.1"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Important-SQL-Questions</h1><a id="logo" href="/.">Jacky Yuan Blog | Tech &amp; ML</a><p class="description"></p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home">Home</i></a><a href="/archives/"><i class="fa fa-archive"> Archive</i></a><a href="/about/"><i class="fa fa-user"> About</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Important-SQL-Questions</h1><div class="post-meta">2020-06-20<span> | </span><span class="category"><a href="/categories/Database/">Database</a></span></div><a class="disqus-comment-count" data-disqus-identifier="2020/06/20/Important-SQL-Questions/" href="/2020/06/20/Important-SQL-Questions/#disqus_thread"></a><div class="post-content"><p><strong>这篇SQL习题是非死不可的力扣题，我自己作为学习记录笔记目的。请勿用于商业目的。</strong></p><a id="more"></a><p><strong>578. Get Highest Answer Rate Question</strong><br>Get the highest answer rate question from a table survey_log with these columns: uid, action, question_id, answer_id, q_num, timestamp.</p><p>uid means user id; action has these kind of values: “show”, “answer”, “skip”; answer_id is not null when action column is “answer”, while is null for “show” and “skip”; q_num is the numeral order of the question in current session.</p><p>Write a sql query to identify the question which has the highest answer rate.</p><p>Example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Input:</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">| uid  | action    | question_id  | answer_id  | q_num     | timestamp  |</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">| 5    | show      | 285          | null       | 1         | 123        |</span><br><span class="line">| 5    | answer    | 285          | 124124     | 1         | 124        |</span><br><span class="line">| 5    | show      | 369          | null       | 2         | 125        |</span><br><span class="line">| 5    | skip      | 369          | null       | 2         | 126        |</span><br><span class="line">+------+-----------+--------------+------------+-----------+------------+</span><br><span class="line">Output:</span><br><span class="line">+-------------+</span><br><span class="line">| survey_log  |</span><br><span class="line">+-------------+</span><br><span class="line">|    285      |</span><br><span class="line">+-------------+</span><br><span class="line">Explanation:</span><br><span class="line">question 285 has answer rate 1&#x2F;1, while question 369 has 0&#x2F;1 answer rate, so output 285.</span><br></pre></td></tr></table></figure><p>Note: The highest answer rate meaning is: answer number’s ratio in show number in the same question.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> question_id <span class="keyword">AS</span> survey_log</span><br><span class="line"><span class="keyword">FROM</span>(</span><br><span class="line"><span class="keyword">SELECT</span> question_id, <span class="keyword">SUM</span>(<span class="keyword">IF</span>(<span class="keyword">action</span>=<span class="string">'answer'</span>,<span class="number">1</span>,<span class="number">0</span>)) / <span class="keyword">SUM</span>(<span class="keyword">IF</span>(<span class="keyword">action</span>=<span class="string">'show'</span>,<span class="number">1</span>,<span class="number">0</span>)) <span class="keyword">as</span> ratio</span><br><span class="line"><span class="keyword">FROM</span> demo.survey_log</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> question_id</span><br><span class="line">) <span class="keyword">AS</span> sub</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> question_id</span><br><span class="line"><span class="keyword">Having</span> <span class="keyword">MAX</span>(ratio);</span><br></pre></td></tr></table></figure><p>这道题我自己拿进数据库跑了一下，是为了验证一下能不能写Having MAX（），注意前面要加GROUP BY因为是aggreated query。MySQL顺序执行：开始-&gt;FROM子句-&gt;WHERE子句-&gt;GROUP BY子句-&gt;HAVING子句-&gt;ORDER BY子句-&gt;SELECT子句-&gt;LIMIT子句-&gt;最终结果</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create table demo.survey_log (uid int,action varchar(25),question_id int,answer_id int,q_num int,timestamp int);</span><br><span class="line"></span><br><span class="line">insert into demo.survey_log values(5,&#39;show&#39;,285,null,1,123);</span><br><span class="line">insert into demo.survey_log values(5,&#39;answer&#39;,285,124124,1,124);</span><br><span class="line">insert into demo.survey_log values(5,&#39;show&#39;,369,null,2,125);</span><br><span class="line">insert into demo.survey_log values(5,&#39;skip&#39;,369,null,2,126);</span><br><span class="line">--随机加了两行试一下</span><br><span class="line">insert into demo.survey_log values(5,&#39;show&#39;,286,null,1,123);</span><br><span class="line">insert into demo.survey_log values(5,&#39;answer&#39;,286,124124,1,124);</span><br></pre></td></tr></table></figure><p>我觉得网上的答案有个问题就是，如果只取一个LIMIT 1，会造成相同的回答率的结果只有一个。</p><p>我个人不推荐，见网友Query：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">SELECT question_id AS &#39;survey_log&#39;</span><br><span class="line">FROM (</span><br><span class="line">    SELECT question_id,</span><br><span class="line">           SUM(CASE WHEN action&#x3D;&#39;answer&#39; THEN 1 ELSE 0 END) AS num_answer,</span><br><span class="line">           SUM(CASE WHEN action&#x3D;&#39;show&#39; THEN 1 ELSE 0 END) AS num_show</span><br><span class="line">    FROM survey_log</span><br><span class="line">    GROUP BY question_id</span><br><span class="line">    ) AS t</span><br><span class="line">ORDER BY (num_answer &#x2F; num_show) DESC</span><br><span class="line">LIMIT 0,1</span><br></pre></td></tr></table></figure><p>还有一种写法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SELECT question_id AS survey_log</span><br><span class="line">FROM survey_log</span><br><span class="line">GROUP BY question_id</span><br><span class="line">ORDER BY SUM(IF(action&#x3D;&#39;answer&#39;, 1, 0)) &#x2F; SUM(IF(action&#x3D;&#39;show&#39;, 1, 0)) DESC</span><br><span class="line">LIMIT 0,1;</span><br></pre></td></tr></table></figure><p><strong>597. Friend Requests I: Overall Acceptance Rate</strong><br>In social network like Facebook or Twitter, people send friend requests and accept others’ requests as well. Now given two tables as below:</p><p>Table: friend_request</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">| sender_id | send_to_id |request_date|</span><br><span class="line">|-----------|------------|------------|</span><br><span class="line">| 1         | 2          | 2016_06-01 |</span><br><span class="line">| 1         | 3          | 2016_06-01 |</span><br><span class="line">| 1         | 4          | 2016_06-01 |</span><br><span class="line">| 2         | 3          | 2016_06-02 |</span><br><span class="line">| 3         | 4          | 2016-06-09 |</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Table: request_accepted</span><br><span class="line">| requester_id | accepter_id |accept_date |</span><br><span class="line">|--------------|-------------|------------|</span><br><span class="line">| 1            | 2           | 2016_06-03 |</span><br><span class="line">| 1            | 3           | 2016-06-08 |</span><br><span class="line">| 2            | 3           | 2016-06-08 |</span><br><span class="line">| 3            | 4           | 2016-06-09 |</span><br><span class="line">| 3            | 4           | 2016-06-10 |</span><br></pre></td></tr></table></figure><p>Write a query to find the overall acceptance rate of requests rounded to 2 decimals, which is the number of acceptance divide the number of requests.</p><p>For the sample data above, your query should return the following result.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">|accept_rate|</span><br><span class="line">|-----------|</span><br><span class="line">|       0.80|</span><br></pre></td></tr></table></figure><p>Note:<br>The accepted requests are not necessarily from the table friend_request. In this case, you just need to simply count the total accepted requests (no matter whether they are in the original requests), and divide it by the number of requests to get the acceptance rate.<br>It is possible that a sender sends multiple requests to the same receiver, and a request could be accepted more than once. In this case, the ‘duplicated’ requests or acceptances are only counted once.<br>If there is no requests at all, you should return 0.00 as the accept_rate.</p><p>Explanation: There are 4 unique accepted requests, and there are 5 requests in total. So the rate is 0.80.</p><p>Follow-up:<br>Can you write a query to return the accept rate but for every month?<br>How about the cumulative accept rate for every day?</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ROUND(</span><br><span class="line">      IFNULL(</span><br><span class="line">        (<span class="keyword">SELECT</span> <span class="keyword">count</span>(*) <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> requester_id, accepter_id <span class="keyword">FROM</span> request_accepted) <span class="keyword">AS</span> A)</span><br><span class="line">        /</span><br><span class="line">        (<span class="keyword">SELECT</span> <span class="keyword">count</span>(*) <span class="keyword">FROM</span> (<span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> sender_id, send_to_id <span class="keyword">FROM</span> friend_request) <span class="keyword">AS</span> B)</span><br><span class="line">        ,<span class="number">0</span>)</span><br><span class="line">,<span class="number">2</span>) <span class="keyword">AS</span> accept_rate</span><br></pre></td></tr></table></figure><figure class="highlight plain"><figcaption><span>count( distinct col1 , col2 , col3 , .......) from table</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#96;&#96;&#96;</span><br><span class="line">但是，这样是不允许的???，因为count是不能统计多个字段的，虽然distinct是可行的。</span><br><span class="line"></span><br><span class="line">有种比较直接的方法就是把消除重复后在统计查询:</span><br><span class="line"></span><br><span class="line">&#96;&#96;&#96;select count(*) from (select distinct col1 ,col2 , col3 from table)A</span><br></pre></td></tr></table></figure><p>但是，我的MYSQL版本可以的。<a href="https://dba.stackexchange.com/questions/127564/how-to-use-count-with-multiple-columns" target="_blank" rel="noopener">https://dba.stackexchange.com/questions/127564/how-to-use-count-with-multiple-columns</a></p><p>为了回答Follow Up题目，我亲测。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">create table demo.request_accepted(</span><br><span class="line">  requester_id int,</span><br><span class="line">  accepter_id varchar(80),</span><br><span class="line">  accept_date MEDIUMTEXT</span><br><span class="line"> );</span><br><span class="line"></span><br><span class="line">insert into demo.request_accepted values(&#39;1&#39;,&#39;2&#39;,&#39;2016-06-03&#39;);</span><br><span class="line">insert into demo.request_accepted values(&#39;1&#39;,&#39;3&#39;,&#39;2016-06-08&#39;);</span><br><span class="line">insert into demo.request_accepted values(&#39;2&#39;,&#39;3&#39;,&#39;2016-06-08&#39;);</span><br><span class="line">insert into demo.request_accepted values(&#39;3&#39;,&#39;4&#39;,&#39;2016-06-09&#39;);</span><br><span class="line">insert into demo.request_accepted values(&#39;3&#39;,&#39;4&#39;,&#39;2016-06-10&#39;);</span><br></pre></td></tr></table></figure><p>Follow Up<br><strong>1.Can you write a query to return the accept rate but for every month?</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="keyword">IFNULL</span>((A.accept_num/B.request_num),<span class="number">0</span>),<span class="number">2</span>) <span class="keyword">AS</span> accept_rate, A.accept_m <span class="keyword">AS</span> <span class="keyword">month</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> requester_id, accepter_id) <span class="keyword">AS</span> accept_num, <span class="keyword">MONTH</span>(accept_date) <span class="keyword">AS</span> accept_m <span class="keyword">FROM</span> demo.request_accepted <span class="keyword">GROUP</span> <span class="keyword">BY</span> accept_m) A,</span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> sender_id, send_to_id) <span class="keyword">AS</span> request_num, <span class="keyword">MONTH</span>(request_date) <span class="keyword">AS</span> request_m <span class="keyword">FROM</span> demo.friend_request <span class="keyword">GROUP</span> <span class="keyword">BY</span> request_m) B</span><br><span class="line"><span class="keyword">WHERE</span> A.accept_m = B.request_m</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> A.accept_m;</span><br></pre></td></tr></table></figure><p>Result<br>{<br>“headers”: [“accept_rate”, “month”],<br>“values”: [[0.80, 6]]<br>}</p><p><strong>Follow-up 2: return the cumulative accept rate for every day</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> requester_id, accepter_id) / <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> sender_id, send_to_id),<span class="number">2</span>) <span class="keyword">AS</span> accept_rate, data_table.dates</span><br><span class="line"><span class="keyword">FROM</span> demo.request_accepted acp, demo.friend_request req,</span><br><span class="line">(<span class="keyword">SELECT</span> request_date <span class="keyword">AS</span> dates <span class="keyword">FROM</span> demo.friend_request</span><br><span class="line"><span class="keyword">UNION</span></span><br><span class="line"><span class="keyword">SELECT</span> accept_date <span class="keyword">FROM</span> demo.request_accepted</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> dates) data_table</span><br><span class="line"><span class="keyword">WHERE</span> acp.accept_date &lt;= data_table.dates <span class="keyword">AND</span> req.request_date &lt;= data_table.dates</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> data_table.dates;</span><br></pre></td></tr></table></figure><p>Result<br>{<br>“headers”: [“rate”, “dates”],<br>“values”: [[0.25, “2016-06-03”], [0.75, “2016-06-08”], [0.80, “2016-06-09”], [0.80, “2016-06-10”]]<br>}</p><p><strong>大家自己写的时候可以把demo去掉。</strong></p><p><strong>602. Friend Requests II: Who Has the Most Friends</strong><br>In social network like Facebook or Twitter, people send friend requests and accept others’ requests as well.</p><p>Table request_accepted holds the data of friend acceptance, while requester_id and accepter_id both are the id of a person.</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">| requester_id | accepter_id | accept_date|</span><br><span class="line">|--------------|-------------|------------|</span><br><span class="line">| 1            | 2           | 2016_06-03 |</span><br><span class="line">| 1            | 3           | 2016-06-08 |</span><br><span class="line">| 2            | 3           | 2016-06-08 |</span><br><span class="line">| 3            | 4           | 2016-06-09 |</span><br><span class="line">Write a query to find the the people who has most friends and the most friends number. For the sample data above, the result is:</span><br><span class="line">| id | num |</span><br><span class="line">|----|-----|</span><br><span class="line">| 3  | 3   |</span><br><span class="line">Note:</span><br><span class="line">It is guaranteed there is only 1 people having the most friends.</span><br><span class="line">The friend request could only been accepted once, which mean there is no multiple records with the same requester_id and accepter_id value.</span><br></pre></td></tr></table></figure><p>Explanation:<br>The person with id ‘3’ is a friend of people ‘1’, ‘2’ and ‘4’, so he has 3 friends in total, which is the most number than any others.</p><p>Follow-up:<br>In the real world, multiple people could have the same most number of friends, can you find all these people in this case?</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> C.id, <span class="keyword">COUNT</span>(C.id) <span class="keyword">AS</span> <span class="keyword">num</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span> requester_id <span class="keyword">id</span></span><br><span class="line"><span class="keyword">FROM</span> request_accepted <span class="keyword">AS</span> A</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> accepter_id <span class="keyword">id</span></span><br><span class="line"><span class="keyword">FROM</span> request_accepted <span class="keyword">AS</span> B</span><br><span class="line">) <span class="keyword">AS</span> C</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> C.id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">COUNT</span>(C.id) <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">1</span> <span class="keyword">OFFSET</span> <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p>Follow-Up: 这个无非就是再取个MAX，取出多个值。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> C.id, <span class="keyword">COUNT</span>(C.id) <span class="keyword">AS</span> <span class="keyword">num</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span> requester_id <span class="keyword">id</span></span><br><span class="line"><span class="keyword">FROM</span> request_accepted <span class="keyword">AS</span> A</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> accepter_id <span class="keyword">id</span></span><br><span class="line"><span class="keyword">FROM</span> request_accepted <span class="keyword">AS</span> B</span><br><span class="line">) <span class="keyword">AS</span> C</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> C.id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(C.id) =</span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span> <span class="keyword">MAX</span>(<span class="keyword">num</span>)</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(<span class="keyword">SELECT</span> C.id, <span class="keyword">COUNT</span>(C.id) <span class="keyword">AS</span> <span class="keyword">num</span></span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(</span><br><span class="line"><span class="keyword">SELECT</span> requester_id <span class="keyword">id</span></span><br><span class="line"><span class="keyword">FROM</span> request_accepted <span class="keyword">AS</span> A</span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> accepter_id <span class="keyword">id</span></span><br><span class="line"><span class="keyword">FROM</span> request_accepted <span class="keyword">AS</span> B</span><br><span class="line">) <span class="keyword">AS</span> C</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> C.id) <span class="keyword">AS</span> D);</span><br></pre></td></tr></table></figure><p><strong>614. Second Degree Follower</strong><br>In facebook, there is a follow table with two columns: followee, follower.</p><p>Please write a sql query to get the amount of each follower’s follower if he/she has one.</p><p>For example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">+-------------+------------+</span><br><span class="line">| followee    | follower   |</span><br><span class="line">+-------------+------------+</span><br><span class="line">|     A       |     B      |</span><br><span class="line">|     B       |     C      |</span><br><span class="line">|     B       |     D      |</span><br><span class="line">|     D       |     E      |</span><br><span class="line">+-------------+------------+</span><br><span class="line">should output:</span><br><span class="line">+-------------+------------+</span><br><span class="line">| follower    | num        |</span><br><span class="line">+-------------+------------+</span><br><span class="line">|     B       |  2         |</span><br><span class="line">|     D       |  1         |</span><br><span class="line">+-------------+------------+</span><br><span class="line">Explaination:</span><br><span class="line">Both B and D exist in the follower list, when as a followee, B&#39;s follower is C and D, and D&#39;s follower is E. A does not exist in follower list.</span><br></pre></td></tr></table></figure><p>Note:<br>Followee would not follow himself/herself in all cases.<br>Please display the result in follower’s alphabet order.</p><p>这个方法Leetcode好像过不了，无奈，还是用土办法吧。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SELECT f.followee AS follower, COUNT(f.followee) AS num</span><br><span class="line">FROM demo.follower f</span><br><span class="line">WHERE f.followee in (SELECT follower FROM demo.follower)</span><br><span class="line">GROUP BY f.followee;</span><br></pre></td></tr></table></figure><p>还是土办法保险：连接两张follow表格。让第二张表的被关注者（followee）等于第一张表的关注者（follower），则第二张表的关注者（follower）就是第一张表关注者的关注者。然后根据第一张表的关注者（follower）分组，对于每组统计第二张表中关注者（follower）的数量。最后排除重复记录，并按照第一张表中关注者（follower）的字母表顺序排序。</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.follower, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> B.follower) <span class="keyword">AS</span> <span class="keyword">num</span></span><br><span class="line"><span class="keyword">FROM</span> demo.follower A</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> demo.follower B</span><br><span class="line"><span class="keyword">ON</span> A.follower = B.followee</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> A.follower;</span><br></pre></td></tr></table></figure><p>参考：<br><a href="https://nifannn.github.io/2018/06/17/SQL-%E7%AC%94%E8%AE%B0-Leetcode-614-Second-Degree-Follower/" target="_blank" rel="noopener">https://nifannn.github.io/2018/06/17/SQL-%E7%AC%94%E8%AE%B0-Leetcode-614-Second-Degree-Follower/</a></p><p><strong>1075. Project Employees I</strong><br>Table: Project</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| project_id  | int     |</span><br><span class="line">| employee_id | int     |</span><br><span class="line">+-------------+---------+</span><br></pre></td></tr></table></figure><p>(project_id, employee_id) is the primary key of this table.<br>employee_id is a foreign key to Employee table.<br>Table: Employee</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| employee_id      | int     |</span><br><span class="line">| name             | varchar |</span><br><span class="line">| experience_years | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">employee_id is the primary key of this table.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Write an SQL query that reports the average experience years of all the employees for each project, rounded to 2 digits.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Project table:</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| project_id  | employee_id |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 1           |</span><br><span class="line">| 1           | 2           |</span><br><span class="line">| 1           | 3           |</span><br><span class="line">| 2           | 1           |</span><br><span class="line">| 2           | 4           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Employee table:</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| employee_id | name   | experience_years |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| 1           | Khaled | 3                |</span><br><span class="line">| 2           | Ali    | 2                |</span><br><span class="line">| 3           | John   | 1                |</span><br><span class="line">| 4           | Doe    | 2                |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| project_id  | average_years |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | 2.00          |</span><br><span class="line">| 2           | 2.50          |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">The average experience years for the first project is (3 + 2 + 1) &#x2F; 3 &#x3D; 2.00 and for the second project is (3 + 2) &#x2F; 2 &#x3D; 2.50</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> project_id,<span class="keyword">ROUND</span>(<span class="keyword">AVG</span>(experience_years),<span class="number">2</span>) <span class="keyword">AS</span> average_years</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Project</span> p</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Employee e</span><br><span class="line">p.employee_id = e.employee_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> projected_id</span><br></pre></td></tr></table></figure><p><strong>1076. Project Employees II</strong><br>Table: Project</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| project_id  | int     |</span><br><span class="line">| employee_id | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">(project_id, employee_id) is the primary key of this table.</span><br><span class="line">employee_id is a foreign key to Employee table.</span><br></pre></td></tr></table></figure><p>Table: Employee</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| employee_id      | int     |</span><br><span class="line">| name             | varchar |</span><br><span class="line">| experience_years | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">employee_id is the primary key of this table.</span><br></pre></td></tr></table></figure><p>Write an SQL query that reports all the projects that have the most employees.</p><p>The query result format is in the following example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">Project table:</span><br><span class="line"></span><br><span class="line">+-------------+-------------+</span><br><span class="line">| project_id  | employee_id |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 1           |</span><br><span class="line">| 1           | 2           |</span><br><span class="line">| 1           | 3           |</span><br><span class="line">| 2           | 1           |</span><br><span class="line">| 2           | 4           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Employee table:</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| employee_id | name   | experience_years |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| 1           | Khaled | 3                |</span><br><span class="line">| 2           | Ali    | 2                |</span><br><span class="line">| 3           | John   | 1                |</span><br><span class="line">| 4           | Doe    | 2                |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+</span><br><span class="line">| project_id  |</span><br><span class="line">+-------------+</span><br><span class="line">| 1           |</span><br><span class="line">+-------------+</span><br><span class="line">The first project has 3 employees while the second one has 2.</span><br></pre></td></tr></table></figure><p>网上标准答案</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> project_id</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Project</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> project_id</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(employee_id) = (<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(employee_id)</span><br><span class="line">                            <span class="keyword">FROM</span> <span class="keyword">Project</span></span><br><span class="line">                            <span class="keyword">GROUP</span> <span class="keyword">BY</span> project_id</span><br><span class="line">                            <span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">COUNT</span>(employee_id) <span class="keyword">DESC</span></span><br><span class="line">                            <span class="keyword">LIMIT</span> <span class="number">1</span>)</span><br><span class="line"><span class="string">``</span><span class="string">`                            </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我觉得我这么写也无所谓，就是一种情况，那就是多个项目人数一样多，我的写法就有问题啦。当然肯定还是上面一种办法保险。</span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">sql</span></span><br><span class="line"><span class="keyword">SELECT</span> project_id</span><br><span class="line"><span class="keyword">FROM</span>(</span><br><span class="line"><span class="keyword">SELECT</span> project_id, <span class="keyword">count</span>(employee_id) <span class="keyword">AS</span> <span class="keyword">num</span></span><br><span class="line"><span class="keyword">FROM</span> demo.project p</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> project_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> <span class="keyword">count</span>(employee_id) <span class="keyword">DESC</span></span><br><span class="line"><span class="keyword">LIMIT</span> <span class="number">1</span>) sub;</span><br></pre></td></tr></table></figure><p><strong>1077. Project Employees III</strong><br>Table: Project</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| project_id  | int     |</span><br><span class="line">| employee_id | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">(project_id, employee_id) is the primary key of this table.</span><br><span class="line">employee_id is a foreign key to Employee table.</span><br><span class="line">Table: Employee</span><br><span class="line"></span><br><span class="line">+------------------+---------+</span><br><span class="line">| Column Name      | Type    |</span><br><span class="line">+------------------+---------+</span><br><span class="line">| employee_id      | int     |</span><br><span class="line">| name             | varchar |</span><br><span class="line">| experience_years | int     |</span><br><span class="line">+------------------+---------+</span><br><span class="line">employee_id is the primary key of this table.</span><br></pre></td></tr></table></figure><p>Write an SQL query that reports the most experienced employees in each project. In case of a tie, report all employees with the maximum number of experience years.</p><p>The query result format is in the following example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Project table:</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| project_id  | employee_id |</span><br><span class="line">+-------------+-------------+</span><br><span class="line">| 1           | 1           |</span><br><span class="line">| 1           | 2           |</span><br><span class="line">| 1           | 3           |</span><br><span class="line">| 2           | 1           |</span><br><span class="line">| 2           | 4           |</span><br><span class="line">+-------------+-------------+</span><br><span class="line"></span><br><span class="line">Employee table:</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| employee_id | name   | experience_years |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line">| 1           | Khaled | 3                |</span><br><span class="line">| 2           | Ali    | 2                |</span><br><span class="line">| 3           | John   | 3                |</span><br><span class="line">| 4           | Doe    | 2                |</span><br><span class="line">+-------------+--------+------------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| project_id  | employee_id   |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | 1             |</span><br><span class="line">| 1           | 3             |</span><br><span class="line">| 2           | 1             |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">Both employees with id 1 and 3 have the most experience among the employees of the first project. For the second project, the employee with id 1 has the most experience.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> P.project_id, E.employee_id</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Project</span> <span class="keyword">AS</span> P <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Employee <span class="keyword">AS</span> E</span><br><span class="line"><span class="keyword">ON</span> P.employee_id = E.employee_id</span><br><span class="line"><span class="keyword">WHERE</span> (P.project_id, E.experience_years) <span class="keyword">IN</span></span><br><span class="line">    (</span><br><span class="line">        <span class="keyword">SELECT</span> P.project_id, <span class="keyword">MAX</span>(E.experience_years)</span><br><span class="line">        <span class="keyword">FROM</span> <span class="keyword">Project</span> <span class="keyword">AS</span> P <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> Employee <span class="keyword">AS</span> E</span><br><span class="line">        <span class="keyword">ON</span> P.employee_id = E.employee_id</span><br><span class="line">        <span class="keyword">GROUP</span> <span class="keyword">BY</span> P.project_id</span><br><span class="line">    )</span><br><span class="line">;</span><br></pre></td></tr></table></figure><p>或者用inner笨办法：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> A.project_id, A.employee_id</span><br><span class="line"><span class="keyword">FROM</span> demo.project <span class="keyword">AS</span> A</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> demo.Employee <span class="keyword">AS</span> B</span><br><span class="line"><span class="keyword">ON</span> A.employee_id = B.employee_id</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span></span><br><span class="line">(<span class="keyword">SELECT</span> project_id, <span class="keyword">MAX</span>(experience_years) <span class="keyword">AS</span> experience_years</span><br><span class="line"><span class="keyword">FROM</span> demo.project p</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> demo.Employee e</span><br><span class="line"><span class="keyword">ON</span> p.employee_id = e.employee_id</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> project_id) <span class="keyword">AS</span> C</span><br><span class="line"><span class="keyword">ON</span> A.project_id = C.project_id <span class="keyword">AND</span> B.experience_years = C.experience_years;</span><br></pre></td></tr></table></figure><p><strong>1113. Reported Posts</strong><br>Table: Actions</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| post_id       | int     |</span><br><span class="line">| action_date   | date    |</span><br><span class="line">| action        | enum    |</span><br><span class="line">| extra         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">There is no primary key for this table, it may have duplicate rows.</span><br><span class="line">The action column is an ENUM type of (&#39;view&#39;, &#39;like&#39;, &#39;reaction&#39;, &#39;comment&#39;, &#39;report&#39;, &#39;share&#39;).</span><br><span class="line">The extra column has optional information about the action such as a reason for report or a type of reaction.</span><br></pre></td></tr></table></figure><p>Write an SQL query that reports the number of posts reported yesterday for each report reason. Assume today is 2019-07-05.</p><p>The query result format is in the following example:</p><p>Actions table:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| user_id | post_id | action_date | action | extra  |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| 1       | 1       | 2019-07-01  | view   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | like   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | share  | null   |</span><br><span class="line">| 2       | 4       | 2019-07-04  | view   | null   |</span><br><span class="line">| 2       | 4       | 2019-07-04  | report | spam   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | view   | null   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | report | spam   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | view   | null   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | report | spam   |</span><br><span class="line">| 5       | 2       | 2019-07-04  | view   | null   |</span><br><span class="line">| 5       | 2       | 2019-07-04  | report | racism |</span><br><span class="line">| 5       | 5       | 2019-07-04  | view   | null   |</span><br><span class="line">| 5       | 5       | 2019-07-04  | report | racism |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+---------------+--------------+</span><br><span class="line">| report_reason | report_count |</span><br><span class="line">+---------------+--------------+</span><br><span class="line">| spam          | 1            |</span><br><span class="line">| racism        | 2            |</span><br><span class="line">+---------------+--------------+</span><br><span class="line">Note that we only care about report reasons with non zero number of reports.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> extra <span class="keyword">as</span> report_reason, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> post_id) <span class="keyword">AS</span> report_count</span><br><span class="line"><span class="keyword">FROM</span> <span class="keyword">Action</span></span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">action</span>=<span class="string">'report'</span> <span class="keyword">AND</span> <span class="keyword">DATEDIFF</span>(<span class="string">'2019-07-05'</span>,action_date) = <span class="number">1</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> extra</span><br><span class="line"><span class="keyword">HAVING</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> post_id) &gt; <span class="number">0</span>;</span><br></pre></td></tr></table></figure><p><strong>1132. Reported Posts II</strong><br>Table: Actions</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| post_id       | int     |</span><br><span class="line">| action_date   | date    |</span><br><span class="line">| action        | enum    |</span><br><span class="line">| extra         | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">There is no primary key for this table, it may have duplicate rows.</span><br><span class="line">The action column is an ENUM type of (&#39;view&#39;, &#39;like&#39;, &#39;reaction&#39;, &#39;comment&#39;, &#39;report&#39;, &#39;share&#39;).</span><br><span class="line">The extra column has optional information about the action such as a reason for report or a type of reaction.</span><br><span class="line">Table: Removals</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| post_id       | int     |</span><br><span class="line">| remove_date   | date    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">post_id is the primary key of this table.</span><br><span class="line">Each row in this table indicates that some post was removed as a result of being reported or as a result of an admin review.</span><br></pre></td></tr></table></figure><p>Write an SQL query to find the average for daily percentage of posts that got removed after being reported as spam, rounded to 2 decimal places.</p><p>The query result format is in the following example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Actions table:</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| user_id | post_id | action_date | action | extra  |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line">| 1       | 1       | 2019-07-01  | view   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | like   | null   |</span><br><span class="line">| 1       | 1       | 2019-07-01  | share  | null   |</span><br><span class="line">| 2       | 2       | 2019-07-04  | view   | null   |</span><br><span class="line">| 2       | 2       | 2019-07-04  | report | spam   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | view   | null   |</span><br><span class="line">| 3       | 4       | 2019-07-04  | report | spam   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | view   | null   |</span><br><span class="line">| 4       | 3       | 2019-07-02  | report | spam   |</span><br><span class="line">| 5       | 2       | 2019-07-03  | view   | null   |</span><br><span class="line">| 5       | 2       | 2019-07-03  | report | racism |</span><br><span class="line">| 5       | 5       | 2019-07-03  | view   | null   |</span><br><span class="line">| 5       | 5       | 2019-07-03  | report | racism |</span><br><span class="line">+---------+---------+-------------+--------+--------+</span><br><span class="line"></span><br><span class="line">Removals table:</span><br><span class="line">+---------+-------------+</span><br><span class="line">| post_id | remove_date |</span><br><span class="line">+---------+-------------+</span><br><span class="line">| 2       | 2019-07-20  |</span><br><span class="line">| 3       | 2019-07-18  |</span><br><span class="line">+---------+-------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-----------------------+</span><br><span class="line">| average_daily_percent |</span><br><span class="line">+-----------------------+</span><br><span class="line">| 75.00                 |</span><br><span class="line">+-----------------------+</span><br><span class="line">The percentage for 2019-07-04 is 50% because only one post of two spam reported posts was removed.</span><br><span class="line">The percentage for 2019-07-02 is 100% because one post was reported as spam and it was removed.</span><br><span class="line">The other days had no spam reports so the average is (50 + 100) &#x2F; 2 &#x3D; 75%</span><br><span class="line">Note that the output is only one number and that we do not care about the remove dates.</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">create table demo.Actions(</span><br><span class="line">  user_id int,</span><br><span class="line">  post_id int,</span><br><span class="line">  action_date MEDIUMTEXT,</span><br><span class="line">  action varchar(20),</span><br><span class="line">  extra varchar(20)</span><br><span class="line"> );</span><br><span class="line"></span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;1&#39;, &#39;1&#39;, &#39;2019-07-01&#39;, &#39;view&#39;, &#39;None&#39;);</span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;1&#39;, &#39;1&#39;, &#39;2019-07-01&#39;, &#39;like&#39;, &#39;None&#39;);</span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;1&#39;, &#39;1&#39;, &#39;2019-07-01&#39;, &#39;share&#39;, &#39;None&#39;);</span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;2&#39;, &#39;2&#39;, &#39;2019-07-04&#39;, &#39;view&#39;, &#39;None&#39;);</span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;2&#39;, &#39;2&#39;, &#39;2019-07-04&#39;, &#39;report&#39;, &#39;spam&#39;);</span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;3&#39;, &#39;4&#39;, &#39;2019-07-04&#39;, &#39;view&#39;, &#39;None&#39;);</span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;3&#39;, &#39;4&#39;, &#39;2019-07-04&#39;, &#39;report&#39;, &#39;spam&#39;);</span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;4&#39;, &#39;3&#39;, &#39;2019-07-02&#39;, &#39;view&#39;, &#39;None&#39;);</span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;4&#39;, &#39;3&#39;, &#39;2019-07-02&#39;, &#39;report&#39;, &#39;spam&#39;);</span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;5&#39;, &#39;2&#39;, &#39;2019-07-03&#39;, &#39;view&#39;, &#39;None&#39;);</span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;5&#39;, &#39;2&#39;, &#39;2019-07-03&#39;, &#39;report&#39;, &#39;racism&#39;);</span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;5&#39;, &#39;5&#39;, &#39;2019-07-03&#39;, &#39;view&#39;, &#39;None&#39;);</span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;5&#39;, &#39;5&#39;, &#39;2019-07-03&#39;, &#39;report&#39;, &#39;racism&#39;);</span><br><span class="line"></span><br><span class="line">insert into demo.Actions (user_id, post_id, action_date, action, extra) values (&#39;6&#39;, &#39;6&#39;, &#39;2019-07-10&#39;, &#39;report&#39;, &#39;spam&#39;);</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM demo.Actions;</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">create table demo.Removals(</span><br><span class="line">  post_id int,</span><br><span class="line">  remove_date MEDIUMTEXT</span><br><span class="line"> );</span><br><span class="line"></span><br><span class="line">insert into demo.Removals values (&#39;2&#39;, &#39;2019-07-20&#39;);</span><br><span class="line">insert into demo.Removals values (&#39;3&#39;, &#39;2019-07-18&#39;);</span><br><span class="line"></span><br><span class="line">insert into demo.Removals values (&#39;5&#39;, &#39;2019-07-30&#39;);</span><br></pre></td></tr></table></figure><p>Solution:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="number">100</span>*<span class="keyword">avg</span>(<span class="keyword">IFNULL</span>(num_remove,<span class="number">0</span>)/num_spam),<span class="number">2</span>)<span class="keyword">as</span> average_daily_percent</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span>(post_id)) <span class="keyword">as</span> num_spam, action_date</span><br><span class="line"><span class="keyword">FROM</span> demo.Actions</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">action</span> = <span class="string">'report'</span> <span class="keyword">AND</span> extra = <span class="string">'spam'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> action_date) A</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span></span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span>(post_id)) num_remove, action_date</span><br><span class="line"><span class="keyword">FROM</span> demo.Actions</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">action</span> = <span class="string">'report'</span> <span class="keyword">AND</span> extra = <span class="string">'spam'</span> <span class="keyword">AND</span> post_id <span class="keyword">in</span> (<span class="keyword">SELECT</span> post_id <span class="keyword">FROM</span> demo.Removals)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> action_date</span><br><span class="line">) B</span><br><span class="line"><span class="keyword">ON</span> A.action_date = B.action_date;</span><br></pre></td></tr></table></figure><p>这里加null的原因是action表格如果有report spam 但是没有处理的，这样合并会产生null值，但是其实avg以后不会count那行null值，没有关系。这道题目重点是要算清楚分子，分母，再加上left join 合并。</p><p><a href="https://zhuanlan.zhihu.com/p/94575159" target="_blank" rel="noopener">https://zhuanlan.zhihu.com/p/94575159</a></p><p><strong>1141. User Activity for the Past 30 Days I</strong><br>Table: Activity</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| session_id    | int     |</span><br><span class="line">| activity_date | date    |</span><br><span class="line">| activity_type | enum    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">There is no primary key for this table, it may have duplicate rows.</span><br><span class="line">The activity_type column is an ENUM of type (&#39;open_session&#39;, &#39;end_session&#39;, &#39;scroll_down&#39;, &#39;send_message&#39;).</span><br><span class="line">The table shows the user activities for a social media website.</span><br><span class="line">Note that each session belongs to exactly one user.</span><br></pre></td></tr></table></figure><p>Write an SQL query to find the daily active user count for a period of 30 days ending 2019-07-27 inclusively. A user was active on some day if he/she made at least one activity on that day.</p><p>The query result format is in the following example:</p><p>Activity table:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| user_id | session_id | activity_date | activity_type |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| 1       | 1          | 2019-07-20    | open_session  |</span><br><span class="line">| 1       | 1          | 2019-07-20    | scroll_down   |</span><br><span class="line">| 1       | 1          | 2019-07-20    | end_session   |</span><br><span class="line">| 2       | 4          | 2019-07-20    | open_session  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | send_message  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | end_session   |</span><br><span class="line">| 3       | 2          | 2019-07-21    | open_session  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | send_message  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | end_session   |</span><br><span class="line">| 4       | 3          | 2019-06-25    | open_session  |</span><br><span class="line">| 4       | 3          | 2019-06-25    | end_session   |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+--------------+</span><br><span class="line">| day        | active_users |</span><br><span class="line">+------------+--------------+</span><br><span class="line">| 2019-07-20 | 2            |</span><br><span class="line">| 2019-07-21 | 2            |</span><br><span class="line">+------------+--------------+</span><br><span class="line">Note that we do not care about days with zero active users.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> activity_date <span class="keyword">AS</span> <span class="keyword">day</span>, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> user_id) <span class="keyword">AS</span> active_users</span><br><span class="line"><span class="keyword">FROM</span> Activity</span><br><span class="line"><span class="keyword">WHERE</span> activity_date <span class="keyword">between</span> <span class="keyword">date_sub</span>(<span class="string">'2019-07-27'</span>, <span class="built_in">interval</span> <span class="number">30</span> <span class="keyword">day</span>) <span class="keyword">AND</span> <span class="string">'2019-07-27'</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> <span class="keyword">day</span>;</span><br></pre></td></tr></table></figure><p><strong>1142. User Activity for the Past 30 Days II</strong><br>Table: Activity</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| session_id    | int     |</span><br><span class="line">| activity_date | date    |</span><br><span class="line">| activity_type | enum    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">There is no primary key for this table, it may have duplicate rows.</span><br><span class="line">The activity_type column is an ENUM of type (&#39;open_session&#39;, &#39;end_session&#39;, &#39;scroll_down&#39;, &#39;send_message&#39;).</span><br><span class="line">The table shows the user activities for a social media website.</span><br><span class="line">Note that each session belongs to exactly one user.</span><br></pre></td></tr></table></figure><p>Write an SQL query to find the average number of sessions per user for a period of 30 days ending 2019-07-27 inclusively, rounded to 2 decimal places. The sessions we want to count for a user are those with at least one activity in that time period.</p><p>The query result format is in the following example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">Activity table:</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| user_id | session_id | activity_date | activity_type |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line">| 1       | 1          | 2019-07-20    | open_session  |</span><br><span class="line">| 1       | 1          | 2019-07-20    | scroll_down   |</span><br><span class="line">| 1       | 1          | 2019-07-20    | end_session   |</span><br><span class="line">| 2       | 4          | 2019-07-20    | open_session  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | send_message  |</span><br><span class="line">| 2       | 4          | 2019-07-21    | end_session   |</span><br><span class="line">| 3       | 2          | 2019-07-21    | open_session  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | send_message  |</span><br><span class="line">| 3       | 2          | 2019-07-21    | end_session   |</span><br><span class="line">| 3       | 5          | 2019-07-21    | open_session  |</span><br><span class="line">| 3       | 5          | 2019-07-21    | scroll_down   |</span><br><span class="line">| 3       | 5          | 2019-07-21    | end_session   |</span><br><span class="line">| 4       | 3          | 2019-06-25    | open_session  |</span><br><span class="line">| 4       | 3          | 2019-06-25    | end_session   |</span><br><span class="line">+---------+------------+---------------+---------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+---------------------------+</span><br><span class="line">| average_sessions_per_user |</span><br><span class="line">+---------------------------+</span><br><span class="line">| 1.33                      |</span><br><span class="line">+---------------------------+</span><br><span class="line">User 1 and 2 each had 1 session in the past 30 days while user 3 had 2 sessions so the average is (1 + 1 + 2) &#x2F; 3 &#x3D; 1.33.</span><br></pre></td></tr></table></figure><p>WAY1:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="keyword">IFNULL</span>(<span class="keyword">AVG</span>(num_session),<span class="number">0</span>),<span class="number">2</span>) <span class="keyword">AS</span> average_session_per_user</span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">(<span class="keyword">SELECT</span> <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> session_id) <span class="keyword">AS</span> num_session</span><br><span class="line"><span class="keyword">FROM</span> Activity</span><br><span class="line"><span class="keyword">WHERE</span> (activity_date <span class="keyword">between</span> <span class="keyword">DATE_SUB</span>(<span class="string">'2019-07-27'</span>, <span class="built_in">INTERVAL</span> <span class="number">30</span> <span class="keyword">DAY</span>) <span class="keyword">and</span> <span class="string">'2019-07-27'</span>) <span class="keyword">AND</span> activity_type <span class="keyword">in</span> (<span class="string">'scroll_down'</span>, <span class="string">'send_message'</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> user_id) <span class="keyword">AS</span> sub</span><br></pre></td></tr></table></figure><p>WAY2:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">ROUND</span>(<span class="keyword">IFNULL</span>(<span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> session_id) / <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> user_id),<span class="number">0</span>),<span class="number">2</span>) <span class="keyword">AS</span> average_session_per_user</span><br><span class="line"><span class="keyword">FROM</span> Activity</span><br><span class="line"><span class="keyword">WHERE</span> (activity_date <span class="keyword">between</span> <span class="keyword">DATE_SUB</span>(<span class="string">'2019-07-27'</span>, <span class="built_in">INTERVAL</span> <span class="number">30</span> <span class="keyword">DAY</span>) <span class="keyword">and</span> <span class="string">'2019-07-27'</span>) <span class="keyword">AND</span> activity_type <span class="keyword">in</span> (<span class="string">'scroll_down'</span>, <span class="string">'send_message'</span>);</span><br></pre></td></tr></table></figure><p><strong>1211. Queries Quality and Percentage</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">Table: Queries</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| query_name  | varchar |</span><br><span class="line">| result      | varchar |</span><br><span class="line">| position    | int     |</span><br><span class="line">| rating      | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">There is no primary key for this table, it may have duplicate rows.</span><br><span class="line">This table contains information collected from some queries on a database.</span><br><span class="line">The position column has a value from 1 to 500.</span><br><span class="line">The rating column has a value from 1 to 5. Query with rating less than 3 is a poor query.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">We define query quality as:</span><br><span class="line"></span><br><span class="line">The average of the ratio between query rating and its position.</span><br><span class="line"></span><br><span class="line">We also define poor query percentage as:</span><br><span class="line"></span><br><span class="line">The percentage of all queries with rating less than 3.</span><br><span class="line"></span><br><span class="line">Write an SQL query to find each query_name, the quality and poor_query_percentage.</span><br><span class="line"></span><br><span class="line">Both quality and poor_query_percentage should be rounded to 2 decimal places.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Queries table:</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line">| query_name | result            | position | rating |</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line">| Dog        | Golden Retriever  | 1        | 5      |</span><br><span class="line">| Dog        | German Shepherd   | 2        | 5      |</span><br><span class="line">| Dog        | Mule              | 200      | 1      |</span><br><span class="line">| Cat        | Shirazi           | 5        | 2      |</span><br><span class="line">| Cat        | Siamese           | 3        | 3      |</span><br><span class="line">| Cat        | Sphynx            | 7        | 4      |</span><br><span class="line">+------------+-------------------+----------+--------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line">| query_name | quality | poor_query_percentage |</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line">| Dog        | 2.50    | 33.33                 |</span><br><span class="line">| Cat        | 0.66    | 33.33                 |</span><br><span class="line">+------------+---------+-----------------------+</span><br><span class="line"></span><br><span class="line">Dog queries quality is ((5 &#x2F; 1) + (5 &#x2F; 2) + (1 &#x2F; 200)) &#x2F; 3 &#x3D; 2.50</span><br><span class="line">Dog queries poor_ query_percentage is (1 &#x2F; 3) * 100 &#x3D; 33.33</span><br><span class="line"></span><br><span class="line">Cat queries quality equals ((2 &#x2F; 5) + (3 &#x2F; 3) + (4 &#x2F; 7)) &#x2F; 3 &#x3D; 0.66</span><br><span class="line">Cat queries poor_ query_percentage is (1 &#x2F; 3) * 100 &#x3D; 33.33</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> query_name, <span class="keyword">ROUND</span>(<span class="keyword">AVG</span>(rating/<span class="keyword">position</span>),<span class="number">2</span>) <span class="keyword">AS</span> quality, <span class="keyword">ROUND</span>(<span class="number">100</span>*<span class="keyword">SUM</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> rating &lt; <span class="number">3</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>)/ <span class="keyword">COUNT</span>(rating),<span class="number">2</span>) <span class="keyword">AS</span> poor_query_percentage</span><br><span class="line"><span class="keyword">FROM</span> Queries</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> query_name;</span><br></pre></td></tr></table></figure><p><strong>1241. Number of Comments per Post</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">Table: Submissions</span><br><span class="line"></span><br><span class="line">+---------------+----------+</span><br><span class="line">| Column Name   | Type     |</span><br><span class="line">+---------------+----------+</span><br><span class="line">| sub_id        | int      |</span><br><span class="line">| parent_id     | int      |</span><br><span class="line">+---------------+----------+</span><br><span class="line">There is no primary key for this table, it may have duplicate rows.</span><br><span class="line">Each row can be a post or comment on the post.</span><br><span class="line">parent_id is null for posts.</span><br><span class="line">parent_id for comments is sub_id for another post in the table.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Write an SQL query to find number of comments per each post.</span><br><span class="line"></span><br><span class="line">Result table should contain post_id and its corresponding number_of_comments, and must be sorted by post_id in ascending order.</span><br><span class="line"></span><br><span class="line">Submissions may contain duplicate comments. You should count the number of unique comments per post.</span><br><span class="line"></span><br><span class="line">Submissions may contain duplicate posts. You should treat them as one post.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example:</span><br><span class="line"></span><br><span class="line">Submissions table:</span><br><span class="line">+---------+------------+</span><br><span class="line">| sub_id  | parent_id  |</span><br><span class="line">+---------+------------+</span><br><span class="line">| 1       | Null       |</span><br><span class="line">| 2       | Null       |</span><br><span class="line">| 1       | Null       |</span><br><span class="line">| 12      | Null       |</span><br><span class="line">| 3       | 1          |</span><br><span class="line">| 5       | 2          |</span><br><span class="line">| 3       | 1          |</span><br><span class="line">| 4       | 1          |</span><br><span class="line">| 9       | 1          |</span><br><span class="line">| 10      | 2          |</span><br><span class="line">| 6       | 7          |</span><br><span class="line">+---------+------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+---------+--------------------+</span><br><span class="line">| post_id | number_of_comments |</span><br><span class="line">+---------+--------------------+</span><br><span class="line">| 1       | 3                  |</span><br><span class="line">| 2       | 2                  |</span><br><span class="line">| 12      | 0                  |</span><br><span class="line">+---------+--------------------+</span><br></pre></td></tr></table></figure><p>The post with id 1 has three comments in the table with id 3, 4 and 9. The comment with id 3 is repeated in the table, we counted it only once.<br>The post with id 2 has two comments in the table with id 5 and 10.<br>The post with id 12 has no comments in the table.<br>The comment with id 6 is a comment on a deleted post with id 7 so we ignored it.</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> A.sub_id, <span class="keyword">COUNT</span>(<span class="keyword">DISTINCT</span> B.sub_id) <span class="keyword">AS</span> number_of_comments</span><br><span class="line"><span class="keyword">FROM</span> demo.sub <span class="keyword">AS</span> A <span class="keyword">LEFT</span> <span class="keyword">JOIN</span> demo.sub <span class="keyword">AS</span> B <span class="keyword">ON</span> A.sub_id = B.parent_id</span><br><span class="line"><span class="keyword">WHERE</span> A.parent_id <span class="keyword">is</span> <span class="literal">null</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">by</span> A.sub_id;</span><br></pre></td></tr></table></figure><p><strong>1264. Page Recommendations</strong><br>SQL Schema<br>Table: Friendship</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| user1_id      | int     |</span><br><span class="line">| user2_id      | int     |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(user1_id, user2_id) is the primary key for this table.</span><br><span class="line">Each row of this table indicates that there is a friendship relation between user1_id and user2_id.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Table: Likes</span><br><span class="line"></span><br><span class="line">+-------------+---------+</span><br><span class="line">| Column Name | Type    |</span><br><span class="line">+-------------+---------+</span><br><span class="line">| user_id     | int     |</span><br><span class="line">| page_id     | int     |</span><br><span class="line">+-------------+---------+</span><br><span class="line">(user_id, page_id) is the primary key for this table.</span><br><span class="line">Each row of this table indicates that user_id likes page_id.</span><br></pre></td></tr></table></figure><p>Write an SQL query to recommend pages to the user with user_id = 1 using the pages that your friends liked. It should not recommend pages you already liked.</p><p>Return result table in any order without duplicates.</p><p>The query result format is in the following example:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Friendship table:</span><br><span class="line">+----------+----------+</span><br><span class="line">| user1_id | user2_id |</span><br><span class="line">+----------+----------+</span><br><span class="line">| 1        | 2        |</span><br><span class="line">| 1        | 3        |</span><br><span class="line">| 1        | 4        |</span><br><span class="line">| 2        | 3        |</span><br><span class="line">| 2        | 4        |</span><br><span class="line">| 2        | 5        |</span><br><span class="line">| 6        | 1        |</span><br><span class="line">+----------+----------+</span><br><span class="line"></span><br><span class="line">Likes table:</span><br><span class="line">+---------+---------+</span><br><span class="line">| user_id | page_id |</span><br><span class="line">+---------+---------+</span><br><span class="line">| 1       | 88      |</span><br><span class="line">| 2       | 23      |</span><br><span class="line">| 3       | 24      |</span><br><span class="line">| 4       | 56      |</span><br><span class="line">| 5       | 11      |</span><br><span class="line">| 6       | 33      |</span><br><span class="line">| 2       | 77      |</span><br><span class="line">| 3       | 77      |</span><br><span class="line">| 6       | 88      |</span><br><span class="line">+---------+---------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+------------------+</span><br><span class="line">| recommended_page |</span><br><span class="line">+------------------+</span><br><span class="line">| 23               |</span><br><span class="line">| 24               |</span><br><span class="line">| 56               |</span><br><span class="line">| 33               |</span><br><span class="line">| 77               |</span><br><span class="line">+------------------+</span><br><span class="line">User one is friend with users 2, 3, 4 and 6.</span><br><span class="line">Suggested pages are 23 from user 2, 24 from user 3, 56 from user 3 and 33 from user 6.</span><br><span class="line">Page 77 is suggested from both user 2 and user 3.</span><br><span class="line">Page 88 is not suggested because user 1 already likes it.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">distinct</span> page_id <span class="keyword">AS</span> recommended_page</span><br><span class="line"><span class="keyword">FROM</span> Likes</span><br><span class="line"><span class="keyword">WHERE</span> user_id <span class="keyword">in</span> (</span><br><span class="line"><span class="keyword">SELECT</span> user2_id <span class="keyword">FROM</span> Friendship <span class="keyword">WHERE</span> user1_id =<span class="number">1</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> user1_id <span class="keyword">FROM</span> Friendship <span class="keyword">WHERE</span> user2_id =<span class="number">1</span></span><br><span class="line">) <span class="keyword">AND</span> page_id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">SELECT</span> page_id <span class="keyword">FROM</span> Likes <span class="keyword">WHERE</span> user_id = <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>下面的方法也可以，但是不够好。因为写了sub query</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">distinct</span> page_id <span class="keyword">AS</span> recommended_page</span><br><span class="line"><span class="keyword">FROM</span> (</span><br><span class="line"><span class="keyword">SELECT</span> user_id, page_id</span><br><span class="line"><span class="keyword">FROM</span> Friendship F</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Likes</span><br><span class="line"><span class="keyword">ON</span> F.user2_id = L.user_id</span><br><span class="line"><span class="keyword">WHERE</span> user1_id = <span class="number">1</span></span><br><span class="line"><span class="keyword">UNION</span> <span class="keyword">ALL</span></span><br><span class="line"><span class="keyword">SELECT</span> user_id, page_id</span><br><span class="line"><span class="keyword">FROM</span> Friendship F</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> Likes L</span><br><span class="line"><span class="keyword">ON</span> F.user1_id = L.user_id</span><br><span class="line"><span class="keyword">WHERE</span> user2_id = <span class="number">1</span></span><br><span class="line">) <span class="keyword">AS</span> sub</span><br><span class="line"><span class="keyword">WHERE</span> page_id <span class="keyword">not</span> <span class="keyword">in</span> (<span class="keyword">SELECT</span> page_id <span class="keyword">FROM</span> Likes <span class="keyword">WHERE</span> user_id = <span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>注意not in的写法， 不是is not in。<br>Union写法，union all 全包，会包含重复值。</p><p><strong>1322. Ads Performance</strong> FB<br>SQL Schema<br>Table: Ads</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| ad_id         | int     |</span><br><span class="line">| user_id       | int     |</span><br><span class="line">| action        | enum    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">(ad_id, user_id) is the primary key for this table.</span><br><span class="line">Each row of this table contains the ID of an Ad, the ID of a user and the action taken by this user regarding this Ad.</span><br><span class="line">The action column is an ENUM type of (&#39;Clicked&#39;, &#39;Viewed&#39;, &#39;Ignored&#39;).</span><br></pre></td></tr></table></figure><p>A company is running Ads and wants to calculate the performance of each Ad.</p><p>Performance of the Ad is measured using Click-Through Rate (CTR) where:</p><p>CTR这里的定义是 Ad total clicks/(Ad total clicks + Ad total views)x100 具体面试和面试官确认</p><p>Write an SQL query to find the ctr of each Ad.</p><p>Round ctr to 2 decimal points. Order the result table by ctr in descending order and by ad_id in ascending order in case of a tie.</p><p>The query result format is in the following example:</p><p>Ads table:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">+-------+---------+---------+</span><br><span class="line">| ad_id | user_id | action  |</span><br><span class="line">+-------+---------+---------+</span><br><span class="line">| 1     | 1       | Clicked |</span><br><span class="line">| 2     | 2       | Clicked |</span><br><span class="line">| 3     | 3       | Viewed  |</span><br><span class="line">| 5     | 5       | Ignored |</span><br><span class="line">| 1     | 7       | Ignored |</span><br><span class="line">| 2     | 7       | Viewed  |</span><br><span class="line">| 3     | 5       | Clicked |</span><br><span class="line">| 1     | 4       | Viewed  |</span><br><span class="line">| 2     | 11      | Viewed  |</span><br><span class="line">| 1     | 2       | Clicked |</span><br><span class="line">+-------+---------+---------+</span><br><span class="line">Result table:</span><br><span class="line">+-------+-------+</span><br><span class="line">| ad_id | ctr   |</span><br><span class="line">+-------+-------+</span><br><span class="line">| 1     | 66.67 |</span><br><span class="line">| 3     | 50.00 |</span><br><span class="line">| 2     | 33.33 |</span><br><span class="line">| 5     | 0.00  |</span><br><span class="line">+-------+-------+</span><br><span class="line">for ad_id &#x3D; 1, ctr &#x3D; (2&#x2F;(2+1)) * 100 &#x3D; 66.67</span><br><span class="line">for ad_id &#x3D; 2, ctr &#x3D; (1&#x2F;(1+2)) * 100 &#x3D; 33.33</span><br><span class="line">for ad_id &#x3D; 3, ctr &#x3D; (1&#x2F;(1+1)) * 100 &#x3D; 50.00</span><br><span class="line">for ad_id &#x3D; 5, ctr &#x3D; 0.00, Note that ad_id &#x3D; 5 has no clicks or views.</span><br><span class="line">Note that we don&#39;t care about Ignored Ads.</span><br><span class="line">Result table is ordered by the ctr. in case of a tie we order them by ad_id</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ad_id, <span class="keyword">IFNULL</span>(<span class="keyword">ROUND</span>(<span class="number">100</span>*<span class="keyword">SUM</span>(<span class="keyword">action</span>=<span class="string">'Clicked'</span>)/(<span class="keyword">SUM</span>(<span class="keyword">action</span>=<span class="string">'Clicked'</span>)+<span class="keyword">SUM</span>(<span class="keyword">action</span>=<span class="string">'Viewed'</span>)),<span class="number">2</span>),<span class="number">0</span>) <span class="keyword">AS</span> ctr</span><br><span class="line"><span class="keyword">FROM</span> Ads</span><br><span class="line"><span class="keyword">WHERE</span> <span class="keyword">action</span> <span class="keyword">in</span> (<span class="string">'Clicked'</span>,<span class="string">'Viewed'</span>)</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ad_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> ctr <span class="keyword">DESC</span>, ad_id <span class="keyword">ASC</span>;</span><br><span class="line"></span><br><span class="line">或者</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> ad_id, <span class="keyword">ROUND</span>(<span class="keyword">IFNULL</span>(<span class="keyword">SUM</span>(<span class="keyword">IF</span>(<span class="keyword">action</span>=<span class="string">'Clicked'</span>, <span class="number">1</span>,<span class="number">0</span>)) / <span class="keyword">SUM</span>(<span class="keyword">CASE</span> <span class="keyword">WHEN</span> <span class="keyword">action</span> = <span class="string">'Clicked'</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">WHEN</span> <span class="keyword">action</span> = <span class="string">'Viewed'</span> <span class="keyword">THEN</span> <span class="number">1</span> <span class="keyword">ELSE</span> <span class="number">0</span> <span class="keyword">END</span>) *<span class="number">100</span>,<span class="number">0</span>),<span class="number">2</span>) <span class="keyword">AS</span> ctr</span><br><span class="line"><span class="keyword">FROM</span> Ads</span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span> ad_id</span><br><span class="line"><span class="keyword">ORDER</span> <span class="keyword">BY</span> ctr <span class="keyword">DESC</span>, ad_id</span><br></pre></td></tr></table></figure><p><strong>1398. Customers Who Bought Products A and B but Not C</strong><br>SQL Schema<br>Table: Customers</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">+---------------------+---------+</span><br><span class="line">| Column Name         | Type    |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">| customer_id         | int     |</span><br><span class="line">| customer_name       | varchar |</span><br><span class="line">+---------------------+---------+</span><br><span class="line">customer_id is the primary key for this table.</span><br><span class="line">customer_name is the name of the customer.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Table: Orders</span><br><span class="line"></span><br><span class="line">+---------------+---------+</span><br><span class="line">| Column Name   | Type    |</span><br><span class="line">+---------------+---------+</span><br><span class="line">| order_id      | int     |</span><br><span class="line">| customer_id   | int     |</span><br><span class="line">| product_name  | varchar |</span><br><span class="line">+---------------+---------+</span><br><span class="line">order_id is the primary key for this table.</span><br><span class="line">customer_id is the id of the customer who bought the product &quot;product_name&quot;.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Write an SQL query to report the customer_id and customer_name of customers who bought products &quot;A&quot;, &quot;B&quot; but did not buy the product &quot;C&quot; since we want to recommend them buy this product.</span><br><span class="line"></span><br><span class="line">Return the result table ordered by customer_id.</span><br><span class="line"></span><br><span class="line">The query result format is in the following example.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Customers table:</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| customer_id | customer_name |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 1           | Daniel        |</span><br><span class="line">| 2           | Diana         |</span><br><span class="line">| 3           | Elizabeth     |</span><br><span class="line">| 4           | Jhon          |</span><br><span class="line">+-------------+---------------+</span><br><span class="line"></span><br><span class="line">Orders table:</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line">| order_id   | customer_id  | product_name  |</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line">| 10         |     1        |     A         |</span><br><span class="line">| 20         |     1        |     B         |</span><br><span class="line">| 30         |     1        |     D         |</span><br><span class="line">| 40         |     1        |     C         |</span><br><span class="line">| 50         |     2        |     A         |</span><br><span class="line">| 60         |     3        |     A         |</span><br><span class="line">| 70         |     3        |     B         |</span><br><span class="line">| 80         |     3        |     D         |</span><br><span class="line">| 90         |     4        |     C         |</span><br><span class="line">+------------+--------------+---------------+</span><br><span class="line"></span><br><span class="line">Result table:</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| customer_id | customer_name |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">| 3           | Elizabeth     |</span><br><span class="line">+-------------+---------------+</span><br><span class="line">Only the customer_id with id 3 bought the product A and B but not the product C.</span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> <span class="keyword">DISTINCT</span> C.customer_id, C.customer_name</span><br><span class="line"><span class="keyword">FROM</span> Customer C</span><br><span class="line"><span class="keyword">WHERE</span> customer_id <span class="keyword">in</span></span><br><span class="line">(<span class="keyword">SELECT</span> customer_id <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> product_name <span class="keyword">in</span> (<span class="string">'A'</span>,<span class="string">'B'</span>) <span class="keyword">GROUP</span> <span class="keyword">BY</span> customer_id <span class="keyword">Having</span> <span class="keyword">count</span>(<span class="keyword">distinct</span> product_name) = <span class="number">2</span>)</span><br><span class="line"><span class="keyword">AND</span> customer_id <span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">(<span class="keyword">SELECT</span> customer_id <span class="keyword">FROM</span> Orders <span class="keyword">WHERE</span> product_name = <span class="string">'C'</span>);</span><br></pre></td></tr></table></figure><p>OR</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> *</span><br><span class="line"><span class="keyword">from</span> Customers</span><br><span class="line"><span class="keyword">where</span> customer_id <span class="keyword">in</span></span><br><span class="line">    (<span class="keyword">select</span> <span class="keyword">distinct</span> customer_id</span><br><span class="line">     <span class="keyword">from</span> Orders</span><br><span class="line">     <span class="keyword">where</span> product_name = <span class="string">'A'</span></span><br><span class="line">    ) <span class="keyword">and</span></span><br><span class="line">    customer_id <span class="keyword">in</span></span><br><span class="line">    (<span class="keyword">select</span> <span class="keyword">distinct</span> customer_id</span><br><span class="line">     <span class="keyword">from</span> Orders</span><br><span class="line">     <span class="keyword">where</span> product_name = <span class="string">'B'</span></span><br><span class="line">    ) <span class="keyword">and</span></span><br><span class="line">    customer_id <span class="keyword">not</span> <span class="keyword">in</span></span><br><span class="line">    (<span class="keyword">select</span> <span class="keyword">distinct</span> customer_id</span><br><span class="line">     <span class="keyword">from</span> Orders</span><br><span class="line">     <span class="keyword">where</span> product_name = <span class="string">'C'</span></span><br><span class="line">    )</span><br><span class="line"><span class="keyword">order</span> <span class="keyword">by</span> customer_id</span><br></pre></td></tr></table></figure></div><div class="post-copyright"><script type="text/javascript" src="/js/copyright.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copyright.css"><p><span>Title: </span>Important-SQL-Questions</p><p><span>Author: </span>Jacky Yuan</p><p><span>Date: </span>2020-06-20</p><p><span>Last Update: </span>2020-06-29</p><p><span>Blog Link: </span><a href="/2020/06/20/Important-SQL-Questions/">http://yoursite.com/2020/06/20/Important-SQL-Questions/</a><span class="copy-path"><i class="fa fa-clipboard" data-clipboard-text="http://yoursite.com/2020/06/20/Important-SQL-Questions/"></i></span></p><p><span>Copyright Declaration: </span>The author owns the copyright. Please indicate the source reproduced!</p></div><br><div class="tags"><a href="/tags/SQL/"><i class="fa fa-tag"></i>SQL</a><a href="/tags/Leetcode/"><i class="fa fa-tag"></i>Leetcode</a><a href="/tags/Facebook/"><i class="fa fa-tag"></i>Facebook</a></div><div class="post-nav"><a class="pre" href="/2020/06/22/SQL-execution-order/">SQL-execution-order</a><a class="next" href="/2020/06/17/SQL-exercises-in-LeetCode-easy-part/">SQL-exercises-in-LeetCode-easy-part</a></div><div id="disqus_thread"><div class="btn_click_load"><button class="disqus_click_btn">阅读评论（请确保 Disqus 可以正常加载）</button></div><script type="text/javascript">var disqus_config=function(){this.page.url="http://yoursite.com/2020/06/20/Important-SQL-Questions/",this.page.identifier="2020/06/20/Important-SQL-Questions/",this.page.title="Important-SQL-Questions"}</script><script type="text/javascript" id="disqus-lazy-load-script">$.ajax({url:"https://disqus.com/next/config.json",timeout:2500,type:"GET",success:function(){var s=document,e=s.createElement("script");e.src="//disqus_TN33Be6Ke8.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(s.head||s.body).appendChild(e),$(".disqus_click_btn").css("display","none")},error:function(){$(".disqus_click_btn").css("display","block")}})</script><script type="text/javascript" id="disqus-click-load">$('.btn_click_load').click(() => {  //click to load comments
    (() => { // DON'T EDIT BELOW THIS LINE
        var d = document;
        var s = d.createElement('script');
        s.src = '//disqus_TN33Be6Ke8.disqus.com/embed.js';
        s.setAttribute('data-timestamp', + new Date());
        (d.head || d.body).appendChild(s);
    })();
    $('.disqus_click_btn').css('display','none');
});</script><script type="text/javascript" id="disqus-count-script">$(function(){var e=new XMLHttpRequest;e.open("GET","//disqus.com/next/config.json",!0),e.timeout=2500,e.onreadystatechange=function(){if(4===e.readyState&&200===e.status){$(".post-meta .post-comments-count").show();var t=document.createElement("script");t.id="dsq-count-scr",t.src="https://disqus_TN33Be6Ke8.disqus.com/count.js",t.async=!0,(document.head||document.body).appendChild(t)}},e.ontimeout=function(){e.abort()},e.send(null)})</script></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><form class="search-form" action="//www.google.com/search" method="get" accept-charset="utf-8" target="_blank"><input type="text" name="q" maxlength="20" placeholder="Search"><input type="hidden" name="sitesearch" value="http://yoursite.com"></form></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o">Categories</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Database/">Database</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o">Tags</i></div><div class="tagcloud"><a href="/tags/SQL/" style="font-size:15px">SQL</a> <a href="/tags/Leetcode/" style="font-size:15px">Leetcode</a> <a href="/tags/Facebook/" style="font-size:15px">Facebook</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o">Recent</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2020/06/22/SQL-execution-order/">SQL-execution-order</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/20/Important-SQL-Questions/">Important-SQL-Questions</a></li><li class="post-list-item"><a class="post-list-link" href="/2020/06/17/SQL-exercises-in-LeetCode-easy-part/">SQL-exercises-in-LeetCode-easy-part</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-comment-o">Recent Comments</i></div><script type="text/javascript" src="//disqus_TN33Be6Ke8.disqus.com/recent_comments_widget.js?num_items=5&amp;hide_avatars=1&amp;avatar_size=32&amp;excerpt_length=20&amp;hide_mods=1"></script></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link">Links</i></div><ul></ul><a href="https://andrewchen.co/" title="andrewchen Growth Hacker" target="_blank">andrewchen Growth Hacker</a><ul></ul><a href="https://www.kaushik.net/avinash/" title="Avinash Kaushik - Web analytics" target="_blank">Avinash Kaushik - Web analytics</a><ul></ul><a href="http://www.woshipm.com/" title="人人都是产品经理" target="_blank">人人都是产品经理</a><ul></ul><a href="https://www.optimizesmart.com/" title="Optimze Smart" target="_blank">Optimze Smart</a><ul></ul><a href="https://www.seanellis.me/" title="Sean Ellis Growth Hacker" target="_blank">Sean Ellis Growth Hacker</a><ul></ul><a href="https://itamargilad.com/" title="Itamar Gilad Growth Hacker" target="_blank">Itamar Gilad Growth Hacker</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">Jacky Yuan Blog | Tech &amp; ML.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//cdn.jsdelivr.net/gh/fancyapps/fancybox/dist/jquery.fancybox.min.css"><script type="text/javascript" src="/js/love.js"></script><script type="text/javascript" src="/js/copycode.js" successtext="Copy Successed!"></script><link rel="stylesheet" type="text/css" href="/css/copycode.css"><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>